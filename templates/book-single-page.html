{% extends 'base.html' %}
{% block content %}
  {% load static %}
  <style>
    .rating {
display: inline-block;
unicode-bidi: bidi-override;
color: #ddd;
font-size: 30px;
}

.rating input {
display: none;
}

.rating label {
cursor: pointer;
}

.rating label:before {
content: "\f005"; /* Star icon from Font Awesome */
font-family: "Font Awesome 5 Free";
font-weight: 900;
}

.rating input:checked ~ label:before {
color: #ffcc00; /* Color for selected stars */
}

.rating:hover input:checked ~ label:before,
.rating:hover label:hover ~ label:before {
color: #ffcc00; /* Color for hovered stars */
}
  </style>
  <script>
    function showEditReviewForm(reviewId) {
        const reviewText = document.getElementById(`review-text-${reviewId}`);
        const ratingInput = document.getElementById(`rating-${reviewId}`);
        const editReviewForm = document.getElementById(`edit-review-form-${reviewId}`);

        reviewText.style.display = 'none';
        ratingInput.style.display = 'inline';
        editReviewForm.style.display = 'block';
    }

    function showEditCommentForm(commentId) {
        const commentText = document.getElementById(`comment-text-${commentId}`);
        const editCommentForm = document.getElementById(`edit-comment-form-${commentId}`);

        commentText.style.display = 'none';
        editCommentForm.style.display = 'block';
    }










  </script>
  <title>Buy {{ book.title }} by {{ book.author_names }}</title>
  <section>
    <div class="container" style="padding-top:60px; padding-bottom:20px;">
      <div class="row">
        <div class="col-md-4 col-sm-12">
          <img src="{{ book.image }}" style="height: 529px; max-width:400px" />
        </div>
        <div class="col-md-5">
          <h3 class="book-title-single">{{ book.title }}</h3>
          <h4 class="book-price-single mt-3">$ {{ book.price }}</h4>
          <div class="row">
            <div class="col-3 col-md-2 col-sm-6 g-0">
              <span class="book-default-single align-items-left">Author:</span>
            </div>
            <div class="col-7 col-md-6 g-0">
              <span class="book-author">{{ book.author_names }}</span>
            </div>
          </div>
          <p class="book-short-desc-single mt-3 g-0">{{ book.description|truncatewords:21 }}</p>
          <div class="row g-0 mt-3">
            <div class="col-3 col-md-2 col-sm-6 g-0">
              <span class="book-default-single align-items-left">Category:</span>
            </div>
            <div class="col-6 col-sm-6 g-0">
              <span class="book-author">{{ book.genre_names }}</span>
            </div>
          </div>
          <div class="row g-0 mt-3">
            <div class="col-3 col-md-2 col-sm-6 g-0">
              <span class="book-default-single align-items-left">Format:</span>
            </div>
            <div class="col-6 col-sm-6 g-0">
              <span class="book-author">{{ book.format }}</span>
            </div>
          </div>
          <div class="row g-0 mt-3">
            <div class="col-3 col-md-2 col-sm-6 g-0">
              <span class="book-default-single align-items-left">Page Count:</span>
            </div>
            <div class="col-6 col-sm-6 g-0">
              <span class="book-author">{{ book.page_count }}</span>
            </div>
          </div>
          <div class="row g-0 mt-3">
            <div class="col-3 col-md-2 col-sm-6 g-0">
              <span class="book-default-single align-items-left">Average Rating:</span>
            </div>
            <div class="col-6 col-sm-6 g-0">
              <span class="book-author">{{ book.average_rating }}</span>
            </div>
          </div>
          <div class="row g-0 mt-3">
            <div class="col-3 col-md-2 col-sm-6 g-0">
              <span class="book-default-single align-items-left">Publication Date:</span>
            </div>
            <div class="col-6 col-sm-6 g-0">
              <span class="book-author">{{ book.publication_date }}</span>
            </div>
          </div>
          <div class="row g-0 mt-3">
            <div class="col-3 col-md-2 col-sm-6 g-0">
              <span class="book-default-single align-items-left">ISBN:</span>
            </div>
            <div class="col-6 col-sm-6 g-0">
              <span class="book-author">{{ book.ISBN }}</span>
            </div>
          </div>
          <div class="row g-0 mt-3">
            <div class="col-3 col-md-2 col-sm-6 g-0">
              <span class="book-default-single align-items-left">Language:</span>
            </div>
            <div class="col-6 col-sm-6 g-0">
              <span class="book-author">{{ book.language }}</span>
            </div>
          </div>
          <div class="row g-0 mt-3">
            <div class="col-2 col-md-2 g-0">
              <span class="book-default-single align-items-left">Share:</span>
            </div>
            <div class="col-6 col-md-4 g-0">
              <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
                 target="_blank"
                 rel="noopener"><i class="fa-brands fa-facebook fa-custom"></i></a> <a href="http://twitter.com/intent/tweet/?url={{ request.build_absolute_uri }}"
    target="_blank"
    rel="noopener"><i class="fa-brands fa-twitter fa-custom"></i>  </a> <a href="https://instagram.com/?url={{ request.build_absolute_uri }}"
    target="_blank"
    rel="noopener"><i class="fa-brands fa-instagram fa-custom"></i> </a> <a href="http://pinterest.com/pin/create/button/?url={{ request.build_absolute_uri }}"
    target="_blank"
    rel="noopener"> <i class="fa-brands fa-pinterest fa-custom"></i></a> <a href="whatsapp://send?text={{ book.title }} available on {{ request.build_absolute_uri }}"
    target="_blank"
    rel="noopener"> <i class="fa-brands fa-whatsapp fa-custom"></i></a>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-12" style="margin-top: 83px;">
          <p class="text-danger" style="font-size:14px;font-weight:600px;">
            <b>Feel free to chat with us</b>
          </p>
          <div class="sidebar-style">
            <i class="fa-solid fa-box"></i> 24 hour Delivery
          </div>
          <div class="sidebar-style">
            <i class="fa-solid fa-truck-clock"></i> Free Shipping
          </div>
          <div class="sidebar-style">
            <i class="fa-solid fa-arrow-rotate-left"></i> 30 Days Refund
          </div>
          <div class="row g-0 pt-4">
            <div class="col">
              {% if book.stocks_available <= 0 %}
                <button class="btn app-addnow-btn btn-disabled">Out of Stock</button>
              {% else %}
                <a href="{% url 'add_cart' book.slug %}" class="btn app-addnow-btn">Add to cart</a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="row" style="margin-top:53px">
          <div class="col-9">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active"
                        id="home-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#home"
                        type="button"
                        role="tab"
                        aria-controls="home"
                        aria-selected="true">Reviews</button>
                <hr>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        id="profile-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#profile"
                        type="button"
                        role="tab"
                        aria-controls="profile"
                        aria-selected="false">Comments</button>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active"
                   id="home"
                   role="tabpanel"
                   aria-labelledby="home-tab">
                <div class="col-md-12">
                  <h2>Reviews</h2>
                  {% if reviews %}
                    {% for review in reviews %}
                      <div class="review">
                        <h5>By {{ review.user.first_name  }} {{ review.user.last_name}}</h5>
                        <p id="rating-{{ review.review_id }}" style="display: none;">Rating: {{ review.rating }}</p>
                        <p id="review-text-{{ review.review_id }}">{{ review.review_text }}</p>
                        <p>Date: {{ review.review_date|date:"F d, Y" }}</p>
                        {% if user.is_authenticated and review.user == user %}
                          <button class="btn btn-primary"
                                  onclick="showEditReviewForm('{{ review.review_id }}')"><i class="fa fa-edit"></i></button>
                          <form id="edit-review-form-{{ review.review_id }}"
                                method="POST"
                                action="{% url 'edit_review' book.slug review.review_id %}"
                                style="display: none">
                            {% csrf_token %}
                            <div class="form-group">
                              <label for="update_rating">Update Rating:</label>
                              <div class="rating">
                                {% for i in '54321' %}
                                  <input type="radio"
                                         id="update-rating-{{ i }}"
                                         name="update_rating"
                                         value="{{ i }}"
                                         {% if review.rating == i|add:'0' %}checked{% endif %}>
                                  <label for="update-rating-{{ i }}">
                                    
                                  </label>
                                {% endfor %}
                              </div>
                            </div>
                            <div class="form-group">
                              <label for="update_review_text">Update Review:</label>
                              <textarea class="form-control"
                                        id="update_review_text"
                                        name="update_review_text"
                                        rows="3"
                                        required>{{ review.review_text }}</textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Confirm</button>
                            <button type="button" class="btn btn-warning" onclick="location.reload()">Cancel</button>
                          </form>
                          <form method="POST"
                                action="{% url 'delete_review' book.slug review.review_id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger"><i class="fa fa-trash"></i></button>
                          </form>
                        {% endif %}
                      </div>
                    {% endfor %}
                  {% else %}
                    <p>No reviews yet.</p>
                  {% endif %}
                  <h3>Add a Review</h3>
                  <form method="post" action="{% url 'add_review' book.slug %}">
                    {% csrf_token %}
                    <div class="form-group">
                      <label for="rating">Rating:</label>
                      <div class="rating">
                        <div class="rating">
                          <input type="radio" id="rating-5" style="display: none;" name="rating" value="5">
                          <label for="rating-5">
                          </label>
                          <input type="radio" id="rating-4" style="display: none;" name="rating" value="4">
                          <label for="rating-4">
                          </label>
                          
                          <input type="radio" id="rating-3" style="display: none;" name="rating" value="3">
                          <label for="rating-3">
                          </label>
                       
                         
                          <input type="radio" id="rating-2" style="display: none;" name="rating" value="2">
                          <label for="rating-2">
                          </label>

                          <input type="radio" id="rating-1" style="display: none;" name="rating" value="1">
                          <label for="rating-1">
                          </label>
                          
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="review_text">Review:</label>
                        <textarea class="form-control"
                                  id="review_text"
                                  name="review_text"
                                  rows="3"
                                  required></textarea>
                      </div>
                      <button type="submit" class="btn btn-primary">Submit Review</button>
                    </form>
                  </div>
                </div>
              </div>
              <div class="tab-pane fade show"
                   id="profile"
                   role="tabpanel"
                   aria-label="profile-tab">
                <div class="col-md-12">
                  <h2>Comments</h2>
                  {% if comments %}
                    {% for comment in comments %}
                      <div class="comment">
                        <h5>By {{ comment.user.first_name }} {{ comment.user.last_name }}</h5>
                        <p id="comment-text-{{ comment.comment_id }}">{{ comment.comment_text }}</p>
                        <p>Date: {{ comment.comment_date|date:"F d, Y" }}</p>
                        {% if user.is_authenticated and comment.user == user %}
                          <button class="btn btn-primary"
                                  onclick="showEditCommentForm('{{ comment.comment_id }}')"><i class="fa fa-edit"></i></button>
                          <form id="edit-comment-form-{{ comment.comment_id }}"
                                method="POST"
                                action="{% url 'edit_comment' book.slug comment.comment_id %}"
                                style="display: none">
                            {% csrf_token %}
                            <div class="form-group">
                              <label for="update_comment_text">Update Comment:</label>
                              <textarea class="form-control"
                                        id="update_comment_text"
                                        name="update_comment_text"
                                        rows="3"
                                        required>{{ comment.comment_text }}</textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Confirm</button>
                            <button type="button" class="btn btn-warning" onclick="location.reload()">Cancel</button>
                          </form>
                          <form method="POST"
                                action="{% url 'delete_comment' book.slug comment.comment_id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger"><i class="fa fa-trash"></i></button>
                          </form>
                        {% endif %}
                      </div>
                    {% endfor %}
                  {% else %}
                    <p>No comments yet.</p>
                  {% endif %}
                  <h3>Add a Comment</h3>
                  <form method="post" action="{% url 'add_comment' book.slug %}">
                    {% csrf_token %}
                    <div class="form-group">
                      <label for="comment_text">Comment:</label>
                      <textarea class="form-control"
                                id="comment_text"
                                name="comment_text"
                                rows="3"
                                required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Comment</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container" style="margin-top:70px;">
      <div class="row text-center">
        <h3 class="text-front-page  pt-3">Related Books</h3>
      </div>
      <div class="product container">
        <div class="row">
          {% for related_book in related_books %}
            <div class="product-box col-6 col-md-2">
              <a class="text-decoration-none" href="/book/{{ related_book.slug }}">
                <img class="product-img" src="{{ related_book.image }}" />
                <h3 class="book-title">{{ related_book.title }}</h3>
                <p class="book-price">
                  <b>{{ related_book.price }} $</b>
                </p>
                <button class="btn btn-custom">Buy Now</button>
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock content %}
